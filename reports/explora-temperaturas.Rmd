---
title: "Temperatura JP x CG"
output:
    html_document:
    df_print: paged
theme: sandstone
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(lubridate)
library(ggbeeswarm)
library(ggplot2)
library(dplyr)
library(tidyr)
theme_set(theme_bw())
```

```{r read}
climas = read_csv(here::here("data/clima_cg_jp-semanal.csv"), 
                  col_types = "cTdddddd")

glimpse(climas)
```

## Temperatura

### Onde é mais quente?

Para responder esta questão iremos considerar a média anual de temperatura de cada cidade com base, a priori, na variável tmedia (temperatura média semanal). Sendo assim, temos: 

```{r}
#descobrir quantas cidades diferentes estão presentes na base de dados. 
unique(climas$cidade)

#separar a base de acordo com as duas cidades.
cg = climas %>% filter(cidade == "Campina Grande")
jp = climas %>% filter(cidade == "João Pessoa")

```

```{r}
#Verificar quantidade de amostras para cada ano
unique(cg$ano)
unique(jp$ano)

climas %>% group_by(cidade) %>% filter(ano ==1992) %>%count(cidade)

```

Como não há registros da temperatura de Campina Grande entre os anos de 1987 e 1991, e há apenas 1 registro do ano de 1992, para está questão vamos considerar apenas registros do ano 1993 em diante.

```{r}
#computar média de temperatura anual de cada cidade

df.mean.temp = climas %>%  filter(ano >=1993) %>% group_by(cidade,ano) %>% 
    summarise(temperatura.media = mean(tmedia))

head(df.mean.temp)
tail(df.mean.temp)

#Plotar gráfico de barra comparando média de temperatura ano a ano de cada cidade
ggplot(df.mean.temp, aes(x=ano, y=temperatura.media, fill=cidade)) +
  geom_bar(stat="identity", color="white", position = "dodge")+
    theme_light()

ggsave("temp_media_anual_cg_jp.png")



```

Sendo assim, com base no gráfico de temperatura média anual de cada cidade plotado acima, podemos concluir que, a partir de 1993, João Pessoa vem apresentando uma temperatura anual mais elevada que Campina Grande. 

### As temperaturas máximas semanais (o pico do calor) são tão diferentes quanto as médias? Mais?  

Para melhor entender a diferença entre essas duas métricas, vamos plotar a distribuição de seus valores.

A seguir temos um histograma representando as medições de temperatuda média.

```{r}
ggplot(climas, aes(x = tmedia)) +geom_histogram(binwidth = 0.8,color= "white", fill = "steelblue")
```

Enquanto que o próximo histograma representa a distribuição da temperatura máxima.
```{r}
ggplot(climas, aes(x = tmax)) +geom_histogram(binwidth = 0.8,color= "white", fill = "steelblue")


```

Com base nos histogramas, podemos concluir que as variáveis tmedia e tmax diferem nos valores das medições, onde a temperatura máxima registrou uma certa quantidade de valores mais elevados, porém em termos de distribuição, os dois casos apresentaram uma distribuição unimodal e assimétrica a esquerda.


### Quais os meses mais quentes e mais frios? 
Para responder esta questão, iremos novamente considerar a média da variável tmedia, porém desta vez não faremos distinção entre as cidades, agrupando os dados apenas pelos meses. Sendo assim, temos:

```{r}

# Calcular e ordenar temperatura média por mês
df.mean.temp.month = climas %>% group_by(mes) %>% summarise(tmedia.mes = mean(tmedia)) %>% arrange(desc(tmedia.mes))

#plotar média bar chart

ggplot(df.mean.temp.month, aes(x=mes, y=tmedia.mes)) +
  geom_bar(stat="identity", color="black", fill = "steelblue", position = "dodge", width = 0.5)+
    theme_gray()+
    geom_text(aes(label=round(tmedia.mes,digits = 2)), vjust=-0.6, color="black", size=3)+
    

ggsave("temp_media_mes.png")

```

Ordenando de maneira decrescente os dados apresentados no gráfico acima, temos que os 3 meses mais quentes são: Março(3), Fevereiro(2) e Dezembro(12).  

```{r}
head(df.mean.temp.month, 3)

```

Enquanto que os meses mais frios são: Julho(7), Agosto(8) e Junho(6)

```{r}
tail(df.mean.temp.month, 3)
```

### Qual foi o São João  mais frio de CG que está nos nossos dados?



## Chuva

### Quanto chove por semana em JP e CG?

Para responder está pergunta vamos calcular a média da quantidade de chuva semanal de cada cidade.

```{r}

#média da coluna chuva agrupada para cidade
df.mean.chuva = climas %>% group_by(cidade) %>% 
    summarise(media.chuva = mean(chuva))

ggplot(df.mean.chuva, aes(x=cidade, y=media.chuva)) +
  geom_bar(stat="identity", fill="steelblue",color="white", width = 0.8)+
    theme_gray()+
    geom_text(aes(label=round(media.chuva,digits = 2)), vjust=-0.6, color="black", size=3)
    

```

De acordo com o gráfico apresentado acima, temos que, considerando um período anual, Campina Grande apresenta uma média de 14mm de chuva semanalmente, enquanto que João Pessoa tem em média 32,65mm de chuva por semana. 

#Como é a distribuição do volume de chuvas por semana em JP e CG? A chuva varia mais ou menos que a temperatura? O formato da distribuição é igual?

Para entender a distribuição do volume de chuvas de cada cidade, primeiro é preciso tratar os dados disponíveis. Sendo assim:

```{r}
climas %>% select(,chuva) %>% summary()

```

Analisando o 3º quartil e o valor máximo, podemos perceber que existem outliers nos dados, então vamos analisar a quantidade de amostras com um valor muito acima da média para saber se podemos excluí-los sem resultar em uma grande perda de dados.

```{r}
climas %>% filter( chuva >=300) %>% nrow()
climas %>% filter( chuva >=200) %>% nrow()
climas %>% filter( chuva >=175) %>% nrow() #max/2
climas %>% nrow()

```

Considerando a metade do valor máximo (175,5) como valor de corte, vamos excluir da análise 28 amostras, o que corresponde a aprximadamente 1% dos dados. Então, temos o seguinte histograma:

```{r}

climas.corte = climas %>% filter(chuva <=175) 

#tamanho da barra correspondente a média das amostras
ggplot(climas.corte, aes(x = chuva, color=cidade),alpha = 0.4, position = "identity")+
    geom_histogram(binwidth =24)+
    scale_fill_manual(values = c("steelblue", "steelred")) +
    scale_color_manual(values = c("steelblue", "yellow"))
```

Com base no histograma apresentado acima, podemos perceber que ambas as cidades apresentam uma distribuição de volume de chuvas semelhantes, sendo unimodal e assimétrica a direita.

### No geral, onde chove mais?

### A distribuição é diferente em meses específicos? 

